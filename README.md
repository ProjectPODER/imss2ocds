# imss2ocds

Transforms IMSS items into OCDS contracts.

## Usage

    (streamed input) | node index.js | (streamed output)

It is recommended that you use the node option *--max-old-space-size* with a value that is at least equal to the amount of data to be transformed. This script needs to load all streamed data into memory in order to properly unify items that may be ordered arbitrarily.

## Input

This script receives as input a list of JSON objects as strings, one per line.

The data contains items previously scraped using [scraper-imss](http://gitlab.rindecuentas.org/equipo-qqw/scraper-imss) and then uploaded to ElasticSearch. The items were processed using Kibana to add custom fields and merge with product data generated by [imss-cbm-parser](http://gitlab.rindecuentas.org/equipo-qqw/imss-cbm-parser). The data was then downloaded using [elasticdump](https://www.npmjs.com/package/elasticdump) as JSON lines.

The list of strings is then streamed through a pipe into the script:

    cat file.json | (imss2ocdss)

## Output

The script outputs JSON documents, one per line, containing contracts in the [OCDS release schema](https://standard.open-contracting.org/latest/en/schema/release/). Items streamed at the input stage are grouped by generating common IDs, then transformed into OCDS and streamed back out. The number of objects streamed out from the script should thus be less than the number of objects streamed in.

### Streaming the output

Use a tool such as http://gitlab.rindecuentas.org/equipo-qqw/stream2db/ to stream the JSON objects back into Mongo or ElasticSearch.
